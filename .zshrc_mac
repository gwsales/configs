#  Black magic to get the *real* dir this file resides in:  http://stackoverflow.com/questions/9901210/bash-source0-equivalent-in-zsh (answer by Hui)
pushd . > /dev/null
SCRIPT_PATH="${(%):-%N}";
if ([ -h "${SCRIPT_PATH}" ]); then
    while ([ -h "${SCRIPT_PATH}" ]); do
        cd `dirname "$SCRIPT_PATH"`
        SCRIPT_PATH=`readlink "${SCRIPT_PATH}"`
    done
fi
cd `dirname ${SCRIPT_PATH}` > /dev/null
SCRIPT_PATH=`pwd`;
popd  > /dev/null


# Path to your oh-my-zsh configuration.
ZSH=$HOME/.oh-my-zsh

# Set name of the theme to load.
# Look in ~/.oh-my-zsh/themes/
# Optionally, if you set this to "random", it'll load a random theme each
# time that oh-my-zsh is loaded.
ZSH_THEME="tjkirch"
#ZSH_THEME="robbyrussell"

# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"

# Set to this to use case-sensitive completion
# CASE_SENSITIVE="true"

# Comment this out to disable bi-weekly auto-update checks
# DISABLE_AUTO_UPDATE="true"

# Uncomment to change how many often would you like to wait before auto-updates occur? (in days)
# export UPDATE_ZSH_DAYS=13

# Uncomment following line if you want to disable colors in ls
# DISABLE_LS_COLORS="true"

# Uncomment following line if you want to disable autosetting terminal title.
# DISABLE_AUTO_TITLE="true"

# Uncomment following line if you want red dots to be displayed while waiting for completion
# COMPLETION_WAITING_DOTS="true"

# Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)
# Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
#gpg-agent

#  Makes browsing large repos bearable
DISABLE_UNTRACKED_FILES_DIRTY="true"

export WORKON_HOME=~/.virtualenvs

plugins=(
    #aws
    ansible
    autopep8
    brew
    cargo
    colorize
    copydir
    copyfile
    cpanm
    docker
    encode64
    fd
    fzf
    git-extras
    git-remote-branch
    gitfast
    gitignore
    golang
    jump
    man
    mercurial
    osx
    pip
    pyenv
    python
    rbenv
    ripgrep
    rsync
    rust
    sbt
    ssh-agent
    sudo
    tig
    tmux
    urltools
    virtualenv
    virtualenvwrapper
)

export DISABLE_VENV_CD=0

source $ZSH/oh-my-zsh.sh

setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_SPACE
export HISTSIZE=100000
export SAVEHIST=$HISTSIZE

function addPath {
    local -i prefix=$1
    local dir=$2

    if [[ -d "$dir" ]] && ! `echo $PATH|egrep "(^|:)$dir(\$|:)" -q`; then
        if [ $prefix -gt 0 ]; then
            export PATH="$dir:$PATH"
        else
            export PATH="$PATH:$dir"
        fi
    fi
}


#  Setup go
export GOPATH=/Users/$USERNAME/go
mkdir -p $GOPATH

# These must be listed in the reverse order!
addPath 1 '/sbin'
addPath 1 '/usr/sbin'
addPath 1 '/usr/local/sbin'
addPath 1 '/bin'
addPath 1 '/usr/bin'
addPath 1 '/usr/local/bin'
addPath 1 "$GOPATH/bin"
addPath 1 '/usr/local/opt/python@2/bin'
addPath 1 '/usr/local/opt/python@3/bin'
addPath 1 '/usr/local/opt/python/libexec/bin'
addPath 1 "$HOME/bin"

addPath 0 '/usr/local/opt/binutils/bin'
addPath 0 '/usr/bin/core_perl'
addPath 0 '/usr/bin/site_perl'
addPath 0 "$HOME/.gem/ruby/2.1.0/bin"

export EDITOR="vim"

#alias cp='/bin/cp -c'
alias rgq='rg --no-filename --no-heading -N'

which exa > /dev/null
if [ $? -eq 0 ] || [ -f "$HOME/.cargo/bin/exa" ]; then
    alias ls='exa --icons'
    alias l='exa --icons'

    alias lla='exa -lgha --icons'
    alias ll='exa -lgh --icons'
    alias la='exa -a --icons'
    alias lt='exa -T --icons'
    alias llt='exa -lgT --icons'
else
    alias ls='ls -h'

    alias ll='ls -l'
    alias la='ls -A'
    alias l='ls -CF'

    alias llx='ll -X'
    alias lx='ls -X'
    alias lla='ls -lA'
fi

alias du='du -h'
alias df='df -h'
alias kk='exit'
alias hkk='history -c;exit'

alias gitk='gitk --all'

alias re='re.pl'

alias -g G='| grep --color=always'
alias -g Gi='| grep -i --color=always'
alias -g Gp='| grep -P --color=always'
alias -g Gpi='| grep -P -i --color=always'
alias -g L='| less -r'
alias -g LC='| wc -l'
alias -g WC='| wc -l'
alias -g UC='| sort | uniq -c | sort -rh'


# Who doesn't want home and end to work?
bindkey '\e[1~' beginning-of-line
bindkey '\e[4~' end-of-line

bindkey '\e[A' up-line-or-history
bindkey '\e[B' down-line-or-history

bindkey '\eOA' up-line-or-history
bindkey '\eOB' down-line-or-history

bindkey '\e[C' forward-char
bindkey '\e[D' backward-char

bindkey '\eOC' forward-char
bindkey '\eOD' backward-char

alias gup='git svn fetch && git svn rebase'
alias gsp='git svn dcommit'

# Double quote single quotes to "escape" them inside a single-quoted string
setopt rcquotes

# SBT Helpers
#alias sbt='sbt -mem 1024 -J-XX:+UseConcMarkSweepGC'
alias sbtd='sbt -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=1099 -J-XX:+UseConcMarkSweepGC'

alias wstart='echo start|entr ./start'

alias genSrc='mkdir -p src/{main,test}/{java,scala,resources} && touch src/{main,test}/{java,scala,resources}/.keep'


# Java 8
export JAVA_OPTS="-server -XX:+UseG1GC -Xms512m -Xmx4G"

export SBT_OPTS="-server -XX:+UseG1GC -Xms512M -Xmx3G -XX:+CMSClassUnloadingEnabled"

alias pip2u="pip2 list -o --format=columns|sed -e '1,2d'|awk '{print $1}'|xargs pip2 install -U"
alias pip3u="pip3 list -o --format=columns|sed -e '1,2d'|awk '{print $1}'|xargs pip3 install -U"
alias pip23u="pip3 list -o --format=columns|sed -e '1,2d'|awk '{print $1}'|xargs pip3 install -U && pip2 list -o --format=columns|sed -e '1,2d'|awk '{print $1}'|xargs pip2 install -U"

#source "$SCRIPT_PATH/zaw/zaw.zsh"

pbrew="$HOME/perl5/perlbrew/etc/bashrc"
if [[ -f "$pbrew" ]]; then
    source "$HOME/perl5/perlbrew/etc/bashrc"
fi
alias mbrew='source "$HOME/perl5/perlbrew/etc/bashrc"'

#bindkey '^R' zaw-history
bindkey '^F' zaw-ack
zstyle ':filter-select' max-lines 10
zstyle ':filter-select' case-insensitive yes
zstyle ':filter-select' extended-search yes

if [[ -f "$HOME/perl5/perlbrew/etc/bashrc" ]]; then
    source "$HOME/perl5/perlbrew/etc/bashrc"
fi

BASH_COLORS="$SCRIPT_PATH/base16/scripts/base16-tomorrow-night-eighties.sh"
if [[ -f $BASH_COLORS ]]; then
    source $BASH_COLORS
fi

if [[ -f "$HOME/.cargo/env" ]]; then
    source $HOME/.cargo/env
fi

#source /usr/local/opt/chruby/share/chruby/chruby.sh
#source /usr/local/opt/chruby/share/chruby/auto.sh

#chruby ruby-2.1.3

#export LC_ALL=C
export LC_ALL=en_US.UTF-8


#  If we have custom things we need to setup, do that now
if [[ -f ~/.zsh_custom ]]; then
    source ~/.zsh_custom
fi

which thefuck >/dev/null
if [ $? -eq 0 ]; then
    eval $(thefuck --alias)
fi

export RIPGREP_CONFIG_PATH="$SCRIPT_PATH/.ripgreprc"

alias rgg='rg -g"!vendor/"'
alias gof='find . -name vendor -prune -o -iname "*.go" -print0|parallel -X0 goimports -w'

alias vim=nvim
